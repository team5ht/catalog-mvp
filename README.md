# Каталог материалов 5HT (MVP)

Статичный прототип каталога PDF-материалов с нижней навигацией, Supabase-авторизацией (email/пароль) и PWA-обёрткой. Легаси-флоу и обратная совместимость удалены — остаётся только текущая схема входа/регистрации.

## Страницы и флоу

- `index.html` — главная. Баннер с внешней ссылкой, две горизонтальные карусели материалов (`data.json`), нижняя навигация.
- `catalog.html` — лента карточек + чипы категорий. Поиск пока заглушка (disabled), фильтрация по категориям работает на клиенте.
- `material.html` — детальная страница по `?id=`: обложка, описание, теги, кнопка загрузки. Кнопка меняет текст в зависимости от авторизации; если пользователь не залогинен, отправляем на `auth-login.html` с редиректом обратно. Кнопка «Назад» старается избегать auth-страниц.
- Авторизация (упрощённая): `auth-login.html` — форма входа/регистрации по email+паролю. Signup при любой ошибке отдаёт одно сообщение; при успехе показывает текст про письмо подтверждения и не редиректит. Login при успехе сразу редиректит на `?redirect=` или `index.html`.
- Кнопка профиля в навигации (`nav-auth.js`): проверяет сессию Supabase (`auth.getSession`/`onAuthStateChange`), подставляет иконки вход/выход, нажатие уводит на `auth-login.html?redirect=<текущий URL>`, выход вызывает `supabaseClient.auth.signOut()` и показывает toast.

## Данные

`data.json` содержит:

- `categories[]`: `id`, `name`, `slug`.
- `materials[]`: `id`, `title`, `description`, `cover`, `pdfUrl`, `categoryId`, `tags[]`.

Карточки на всех страницах читают данные напрямую из этого файла; изображения и PDF — внешние URL.

## Авторизация и состояние

- `supabase-config.js` — объявляет `window.SUPABASE_URL` и `window.SUPABASE_PUBLISHABLE_KEY` (publishable/public key). Скрипт подключается до Supabase SDK и `supabase-client.js`; для другого проекта обновите значения здесь или задайте их в раннем инлайне.
- `supabase-client.js` — создаёт shared-клиент Supabase из CDN, читает `window.SUPABASE_URL`/`window.SUPABASE_PUBLISHABLE_KEY`. При отсутствии SDK/конфигурации выводит warn и оставляет `supabaseClient = null`.
- `nav-auth.js` — отвечает за кнопку профиля: проверяет сессию Supabase, переключает иконку, делает `signOut()` и редиректит незалогиненных на `auth-login.html?redirect=<текущий>`.
- `material.html` — напрямую обращается к Supabase: проверяет сессию, обновляет текст кнопки скачивания, при отсутствии сессии отправляет на `auth-login.html?redirect=<current>`.
- `app.js` — утилиты для рендера каруселей/каталога, без логики авторизации.

## Стили

Система токенов и базовые слои: `styles/tokens.css`, `styles/base.css`, общие компоненты (`styles/components/*`), стили страниц (`styles/pages/*`). Подробности структуры и рекомендации — в `styles/README.md`.

## PWA

- `manifest.json` с иконками (`icon-192.png`, `icon-512.png`) и скриншотом.
- `sw.js` кэширует список `urlsToCache` и работает под версией `catalog-mvp-v5`. Включены auth-страницы, основные скрипты и стили. При добавлении/переименовании файлов обновляйте список и версию кэша.

## Локальный запуск

Статический проект, сборки нет. Для корректной загрузки `data.json` и service worker нужен простой HTTP-сервер:

```bash
python -m http.server 8000
# или
npx serve .
```

Откройте `http://localhost:8000/`.

## Известные ограничения

- Поиск в каталоге пока заглушка.
- Конфигурация Supabase задаётся в `supabase-config.js` как `window.SUPABASE_URL/PUBLISHABLE_KEY`. Храните здесь только publishable key (secret не нужен и не должен попадать в браузер). Проверки email/пароля полностью на стороне Supabase, без собственного backend.
- В `data.json` стоят плейсхолдеры `pdfUrl`; для реальных материалов нужны валидные ссылки.
- Список кэша в `sw.js` поддерживается вручную; новый ассет/страницу нужно добавить в `urlsToCache` и поднять версию.
- Авторизация опирается исключительно на Supabase. Signup без сессии — нормальный кейс при подтверждении email, UI сообщает о письме; нет кастомных хранилищ/событий авторизации.
