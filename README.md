# Каталог материалов 5HT (MVP)

Статичный прототип каталога PDF-материалов с нижней навигацией, Supabase-авторизацией (email/пароль) и PWA (manifest + service worker). Данные берутся из `data.json`, сборки нет.

## Страницы и флоу

- `index.html` - главная: баннер с внешней ссылкой, две горизонтальные карусели из `data.json`, нижняя навигация. `loadAppData()` делает `fetch` с `cache: "no-cache"` и кеширует результат в памяти; при недоступности файла показывается inline-ошибка.
- `catalog.html` - лента карточек + чипы категорий. Поиск пока заглушка (disabled), фильтрация по категориям выполняется на клиенте через функции из `app.js`. При ошибке загрузки данных категории и карточки показывают сообщение.
- `material.html` - детальная страница по `?id=`: обложка, описание, теги (иначе «Без тегов»), кнопка скачивания. Если `id` нет/не найден, уводит на `index.html`. Кнопка скачивания меняет текст/стили в зависимости от сессии Supabase (слушает `onAuthStateChange`); незалогиненных отправляет на `auth-login.html?redirect=<текущий URL>`, залогиненным открывает `pdfUrl` в новой вкладке. Кнопка «Назад» строится из `document.referrer` + `sessionStorage`, пропуская auth-страницы, с запасным `catalog.html`. При ошибках данных показывается сообщение и кнопка блокируется.
- `account.html` - личный кабинет: берёт текущую сессию через `supabaseClient.auth.getSession()`, без неё сразу редиректит на `auth-login.html?redirect=<URL страницы>`. Показывает email пользователя (некликабельный), кнопки «Изменить пароль» (пока `alert('Функция в разработке')`) и «Выйти» (`signOut()` с редиректом на `auth-login.html?redirect=index.html`), отдельный блок с версией приложения.
- `auth-login.html` - одна форма для входа/регистрации по email+паролю. Валидирует email и минимум 6 символов пароля, отключает элементы на время запросов, показывает ошибку, если Supabase недоступен. Signup: выводит спец-сообщение, если пользователь уже существует; при успехе сообщает о письме подтверждения и остаётся на странице. Login: `signInWithPassword`, редирект только на проверенные URL текущего origin (`?redirect=`), иначе `index.html`. Нужное действие определяется по нажатой кнопке (`data-action`).
- Кнопка профиля в навигации (`nav-auth.js`): проверяет сессию Supabase (`auth.getSession`/`onAuthStateChange`), подставляет иконки вход/выход и aria-label, скрыта до загрузки сессии. Нажатие незалогиненных уводит на `auth-login.html?redirect=<текущий URL>`, залогиненных - открывает страницу личного кабинета `account.html`.

## Данные

`data.json` содержит:

- `categories[]`: `id`, `name`, `slug`.
- `materials[]`: `id`, `title`, `description`, `cover`, `pdfUrl`, `categoryId`, `tags[]`.

Карточки на всех страницах читают данные напрямую из этого файла; `cover`/`pdfUrl` указывают на внешние URL.

## Авторизация и состояние

- `supabase-config.js` - объявляет `window.SUPABASE_URL` и `window.SUPABASE_PUBLISHABLE_KEY` (publishable/public key). Скрипт подключается до Supabase SDK и `supabase-client.js`; для другого проекта обновите значения здесь или задайте их в раннем инлайне.
- `supabase-client.js` - создаёт shared-клиент Supabase из CDN, читает `window.SUPABASE_URL`/`window.SUPABASE_PUBLISHABLE_KEY`. При отсутствии SDK/конфигурации выводит warn и оставляет `supabaseClient = null`.
- `nav-auth.js` / `material.html` - используют Supabase: проверяют сессию, подписываются на `onAuthStateChange`, переключают UI и перенаправляют пользователей в зависимости от авторизации (вход/профиль, доступ к скачиванию).
- `account.html` - проверяет сессию сразу при загрузке и через `onAuthStateChange`. Без сессии уводит на `auth-login.html?redirect=<URL>`, с сессией показывает email и даёт кнопку выхода (`signOut()` + редирект на логин).
- `app.js` - единая загрузка данных (`loadAppData` с кешированием и обработкой ошибок), рендер каруселей/категорий/каталога, helper `renderInlineError`. Логики авторизации нет.

## Стили

Система токенов и базовые слои: `styles/tokens.css`, `styles/base.css`, общие компоненты (`styles/components/*`), стили страниц (`styles/pages/*`). Подробности структуры и рекомендации - в `styles/README.md`.

## PWA

- `manifest.json` с иконками (`icon-192.png`, `icon-512.png`), без скриншотов.
- `sw.js` работает под версией `catalog-mvp-v6`. `urlsToCache` включает ключевые страницы, скрипты и стили. Стратегия: same-origin GET сначала сеть с записью в кэш, при ошибке - ответ из кэша; для `navigate` в оффлайне отдаётся закешированный `index.html`. При добавлении/переименовании файлов обновляйте список и версию кэша.

## Локальный запуск

Статический проект, сборки нет. Для корректной загрузки `data.json` и service worker нужен простой HTTP-сервер:

```bash
python -m http.server 8000
# или
npx serve .
```

Откройте `http://localhost:8000/`.

## Известные ограничения

- Поиск в каталоге пока заглушка.
- Конфигурация Supabase задаётся в `supabase-config.js` как `window.SUPABASE_URL/PUBLISHABLE_KEY`. Храните здесь только publishable key (secret не нужен и не должен попадать в браузер). Проверки email/пароля полностью на стороне Supabase, без собственного backend; восстановления пароля в UI нет.
- В `data.json` стоят плейсхолдеры `pdfUrl`; для реальных материалов нужны валидные ссылки.
- Список кэша в `sw.js` поддерживается вручную; новый ассет/страницу нужно добавить в `urlsToCache` и поднять версию. Контент оффлайн доступен только после первой успешной загрузки; авторизация требует сети.
- Авторизация опирается исключительно на Supabase. Signup без сессии - нормальный кейс при подтверждении email, UI сообщает о письме; нет кастомных хранилищ/событий авторизации.
- При недоступности `data.json` страницы показывают inline-ошибку вместо пустого состояния.
