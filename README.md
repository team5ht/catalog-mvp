# Каталог материалов 5HT (MVP)

Статичный прототип каталога PDF-материалов: главная с подборками, каталог с фильтрацией по категориям, детальная карточка материала с кнопкой загрузки, простая псевдо-авторизация и PWA-обёртка.

## Страницы и флоу
- `index.html` — главная. Баннер с внешней ссылкой, две горизонтальные карусели материалов (`data.json`), нижняя навигация.
- `catalog.html` — лента карточек + чипы категорий. Поиск пока заглушка (disabled), фильтрация по категориям работает на клиенте.
- `material.html` — детальная страница по `?id=`: обложка, описание, теги, кнопка «Скачать». Текст кнопки и доступность завязаны на состояние авторизации. При отсутствии авторизации отправляет на `auth-login.html` с редиректом обратно.
- Авторизация: `auth-login.html` (ввод email) → `auth-check-email.html` (подтверждение + «магическая» ссылка) → `auth-callback.html` (ставит `localStorage.auth_logged_in` и возвращает на сохранённый URL). Кнопка профиля в навигации (`nav-auth.js`) переключается между входом/выходом и шлёт событие `authstatechange`.
- Легаси: `login.html` и `app.js#checkAuth` используют ключ `isLoggedIn` — оставлено для совместимости, но основное состояние авторизации хранится в `auth_logged_in`.

## Данные
`data.json` содержит:
- `categories[]`: `id`, `name`, `slug`.
- `materials[]`: `id`, `title`, `description`, `cover`, `pdfUrl`, `categoryId`, `tags[]`.
Карточки на всех страницах читают данные напрямую из этого файла; изображения — внешние URL.

## Скрипты
- `app.js` — хелперы авторизации (проверка, logout), экспорт `window.isUserAuthenticated`, рендер главных блоков, категорий и списка каталога.
- `auth-state.js` — утилиты `AuthState` для проверки авторизации и хранения `authRedirectUrl`.
- `nav-auth.js` — логика кнопки профиля: подстановка иконок вход/выход, редирект на форму логина, очистка ключа `auth_logged_in`, отправка `authstatechange`.
- Inline-скрипты на страницах используют эти функции для навигации и рендера.

## Стили
Система токенов и базовые слои: `styles/tokens.css`, `styles/base.css`, общие компоненты (`styles/components/*`), стили страниц (`styles/pages/*`). Подробности структуры — в `styles/README.md`.

## PWA
- `manifest.json` с иконками (`icon-192.png`, `icon-512.png`) и скриншотом.
- `sw.js` кэширует ограниченный список файлов (`urlsToCache`) и обновляет кэш по версии `catalog-mvp-v2`. При добавлении страниц/ассетов нужно обновлять этот список и версию. Сейчас там есть устаревшая ссылка на `style.css` и нет новых auth-страниц — при оффлайне они недоступны.

## Локальный запуск
Статический проект, сборки нет. Для корректной загрузки `data.json` и service worker нужен простой HTTP-сервер:
```bash
python -m http.server 8000
# или
npx serve .
```
Откройте `http://localhost:8000/`.

## Известные ограничения
- Авторизация целиком на `localStorage`, без отправки писем и без backend-проверок.
- Поиск в каталоге пока заглушка.
- Дублирование ключей авторизации (`auth_logged_in` vs `isLoggedIn`); основная логика опирается на `auth_logged_in`.
- Список кэша в `sw.js` требует синхронизации при добавлении страниц или ассетов.
