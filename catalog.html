<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Каталог</title>
<link rel="stylesheet" href="styles/tokens.css" />
<link rel="stylesheet" href="styles/base.css" />
<link rel="stylesheet" href="styles/components/buttons.css" />
<link rel="stylesheet" href="styles/components/cards.css" />
<link rel="stylesheet" href="styles/components/scroll-containers.css" />
<link rel="stylesheet" href="styles/components/navigation.css" />
<link rel="stylesheet" href="styles/pages/catalog.css" />
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f8fafc">
</head>
<body>
<main>
  <section class="catalog-search" aria-label="Поиск по каталогу">
    <div class="catalog-search__field">
      <svg class="catalog-search__icon" width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M15.5 14h-.79l-.28-.27a6 6 0 1 0-.71.71l.27.28v.79l4.25 4.25a1 1 0 0 0 1.42-1.42L15.5 14zm-5 0a4 4 0 1 1 0-8 4 4 0 0 1 0 8z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
      <input class="catalog-search__input" type="search" name="search" placeholder="Поиск скоро заработает" disabled aria-label="Поиск скоро заработает" />
    </div>
  </section>
  <section id="categories" class="catalog-categories">
    <!-- Категории будут вставлены скриптом -->
  </section>
  <section id="catalog-list" class="catalog-list">
    <!-- Лента карточек каталога -->
  </section>
</main>

<nav class="bottom-nav">
  <button id="nav-home" class="bottom-nav__button" aria-label="Главная">
    <svg class="bottom-nav__icon" width="24" height="24"><path d="M3 12l9-9 9 9v9a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-9z" fill="none" stroke-width="2"/></svg>
  </button>
  <button id="nav-catalog" class="bottom-nav__button bottom-nav__button--active" aria-label="Каталог">
    <svg class="bottom-nav__icon" width="24" height="24"><rect x="3" y="4" width="18" height="16" fill="none" stroke-width="2"/></svg>
  </button>
  <button id="nav-login" class="bottom-nav__button" aria-label="Профиль">
    <svg class="bottom-nav__icon" width="24" height="24"><circle cx="12" cy="8" r="4" fill="none" stroke-width="2"/><path d="M4 20c0-4 16-4 16 0" fill="none" stroke-width="2"/></svg>
  </button>
</nav>

<script src="app.js"></script>
<script>
function renderCategories(categories) {
  const container = document.getElementById('categories');
  container.innerHTML = '';
  categories.forEach(cat => {
    const btn = document.createElement('button');
    btn.className = 'catalog-categories__button';

    const chip = document.createElement('span');
    chip.className = 'chip chip--interactive';
    chip.textContent = cat.name;
    btn.appendChild(chip);

    btn.onclick = () => {
      document.querySelectorAll('.catalog-categories__button .chip').forEach(chipEl => chipEl.classList.remove('chip--active'));
      chip.classList.add('chip--active');
      filterCatalog(cat.id);
    };
    container.appendChild(btn);
  });

  const firstChip = container.querySelector('.catalog-categories__button .chip');
  if (firstChip) {
    firstChip.classList.add('chip--active');
  }
}

function renderCatalog(materials) {
  const container = document.getElementById('catalog-list');
  container.innerHTML = '';
  materials.forEach(m => {
    const item = document.createElement('article');
    item.className = 'catalog-card';

    const coverLink = document.createElement('a');
    coverLink.className = 'catalog-card__cover';
    coverLink.style.backgroundImage = `url(${m.cover})`;
    coverLink.href = `material.html?id=${m.id}`;
    coverLink.setAttribute('aria-label', m.title);

    const info = document.createElement('div');
    info.className = 'catalog-card__info';

    const title = document.createElement('h3');
    title.className = 'catalog-card__title';
    const titleLink = document.createElement('a');
    titleLink.className = 'catalog-card__title-link';
    titleLink.href = `material.html?id=${m.id}`;
    titleLink.textContent = m.title;
    title.appendChild(titleLink);

    info.appendChild(title);
    item.appendChild(coverLink);
    item.appendChild(info);
    container.appendChild(item);
  });
}


function filterCatalog(categoryId) {
  if (!categoryId) {
    renderCatalog(appData.materials);
  } else {
    const filtered = appData.materials.filter(m => m.categoryId === categoryId);
    renderCatalog(filtered);
  }
}

document.getElementById('nav-home').onclick = () => location.href = 'index.html';
document.getElementById('nav-login').onclick = () => location.href = 'login.html';

fetch('data.json').then(r => r.json()).then(data => {
  appData = data;
  renderCategories(data.categories);
  renderCatalog(data.materials);
});
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js');
  });
}
</script>
</body>
</html>
