<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <link rel="manifest" href="manifest.json">
    <title>–ú–∞—Ç–µ—Ä–∏–∞–ª</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>üìö –ö–∞—Ç–∞–ª–æ–≥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h1>
        </div>
    </header>

    <main class="container">
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Ç–µ—Ä–∏–∞–ª–µ -->
        <div id="material-detail" class="material-detail">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <div id="loader" class="loader">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 –ö–∞—Ç–∞–ª–æ–≥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –º–∞—Ç–µ—Ä–∏–∞–ª–µ
        async function loadMaterial() {
            // –ü–æ–ª—É—á–∞–µ–º ID –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∏–∑ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: material.html?id=1)
            const urlParams = new URLSearchParams(window.location.search);
            const materialId = parseInt(urlParams.get('id'));

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (!isLoggedIn) {
                alert('–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤');
                window.location.href = 'login.html';
                return;
            }

            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON
                const response = await fetch('data.json');
                const data = await response.json();
                
                // –ù–∞—Ö–æ–¥–∏–º –Ω—É–∂–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ ID
                const material = data.materials.find(m => m.id === materialId);
                
                if (!material) {
                    document.getElementById('material-detail').innerHTML = 
                        '<p class="error">–ú–∞—Ç–µ—Ä–∏–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω</p>';
                    return;
                }

                // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                const category = data.categories.find(c => c.id === material.categoryId);

                // –°–∫—Ä—ã–≤–∞–µ–º loader
                document.getElementById('loader').style.display = 'none';

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                document.getElementById('material-detail').innerHTML = `
                    <a href="index.html?category=${category.slug}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
                    
                    <div class="material-content">
                        <div class="material-image">
                            <img src="${material.cover}" alt="${material.title}">
                        </div>
                        
                        <div class="material-info">
                            <span class="category-badge">${category.name}</span>
                            <h1>${material.title}</h1>
                            <p class="material-description">${material.description}</p>
                            
                            <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è PDF —Å Google Drive -->
                            <a href="${material.pdfUrl}" 
                               target="_blank" 
                               class="btn-primary download-btn"
                               onclick="trackDownload('${material.title}')">
                                üì• –°–∫–∞—á–∞—Ç—å PDF
                            </a>
                            
                            <p class="download-hint">
                                –§–∞–π–ª –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ. –ù–∞–∂–º–∏—Ç–µ "–°–∫–∞—á–∞—Ç—å" –≤ Google Drive.
                            </p>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞:', error);
                document.getElementById('material-detail').innerHTML = 
                    '<p class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏–π (–¥–ª—è –±—É–¥—É—â–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
        function trackDownload(title) {
            console.log('–°–∫–∞—á–∞–Ω –º–∞—Ç–µ—Ä–∏–∞–ª:', title);
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ Google Analytics –∏–ª–∏ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫—É
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadMaterial();

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker (–ò–°–ü–†–ê–í–õ–ï–ù–û)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js', { scope: './' })
                    .then(reg => console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
                    .catch(err => console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ SW:', err));
            });
        }
    </script>
</body>
</html>
